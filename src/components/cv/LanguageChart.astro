---
interface Props {
  labels: string[]; // e.g. ['Spanish', 'English'...]
  datasetLabel: string; // e.g. 'Skill Level'
}

const { labels, datasetLabel } = Astro.props;
---

<div class="bar-plot-container">
    <canvas id="langChart"></canvas>
</div>

<script is:inline src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script is:inline define:vars={{ labels, datasetLabel }}>
    // This script now runs using the data passed from the props!
    function lightenColor(color, percent) {
        const num = parseInt(color.slice(1), 16),
            amt = Math.round(2.55 * percent),
            R = (num >> 16) + amt,
            G = (num >> 8 & 0x00FF) + amt,
            B = (num & 0x0000FF) + amt;
        return `#${(0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1).toUpperCase()}`;
    }

    const baseColor = '#ff7a57';
    const colors = [
        baseColor,
        lightenColor(baseColor, 0),
        lightenColor(baseColor, 10),
        lightenColor(baseColor, 20),
        lightenColor(baseColor, 20),
        lightenColor(baseColor, 30),
        lightenColor(baseColor, 35),
        lightenColor(baseColor, 35),
        lightenColor(baseColor, 35),
    ];

    const data_lang = {
        labels: labels, // Uses the prop
        datasets: [{
            label: datasetLabel, // Uses the prop
            data: [100, 90, 40, 30],
            backgroundColor: colors, 
            borderColor: colors, 
            borderWidth: 1
        }]
    };

    const config_lang = {
        type: 'bar', 
        data: data_lang,
        options: {
            indexAxis: 'y', 
            scales: {
                x: { display: false },
                y: { grid: { display: false } }
            },
            plugins: {
                legend: { display: false }
            }
        }
    };
    
    // Check if chart already exists to prevent errors during navigation
    const ctx = document.getElementById('langChart');
    if(ctx) {
        new Chart(ctx, config_lang);
    }
</script>